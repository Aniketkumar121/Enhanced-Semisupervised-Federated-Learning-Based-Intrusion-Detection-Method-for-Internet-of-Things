# ğŸš¨ Advanced Geometric Aggregation and Gradient
Regularization Framework for Semi-supervised
Federated Intrusion Detection in Heterogeneous IoT
Environments

This repository contains the implementation of an **Enhanced Semi-Supervised Federated Learning-based Intrusion Detection System (USSFL-IDS)**. It is based on the paper:

> ğŸ“„ *Zhao et al., "Semi-supervised Federated-Learning-Based Intrusion Detection Method for Internet of Things", IEEE 2023*

We further extend their work by integrating **robust aggregation**, **gradient variance tracking**, **Fishr regularization**, and **visual analytics** to improve generalization and transparency.

---

## ğŸ“Œ Project Highlights

### ğŸ” Problem

Detecting network intrusions in **Internet of Things (IoT)** environments using **semi-supervised federated learning**, where client data is heterogeneous (non-IID) and privacy-sensitive.

### ğŸš€ Key Enhancements

| Feature                    | Description                                              |
| -------------------------- | -------------------------------------------------------- |
| **Gradient Aggregation**   | Supports both Arithmetic and Geometric Mean              |
| **Fishr Regularization**   | Penalizes gradient variance divergence across clients    |
| **Gradient Variance**      | Tracks gradient dispersion for robust training           |
| **Discriminator Training** | Differentiates known vs unknown samples                  |
| **Voting Mechanism**       | Aggregates logits using hard label voting                |
| **Visualizations**         | Confusion Matrix, Class Distribution, Accuracy/F1 Trends |

---

## ğŸ“‚ Directory Structure

```
USSFL/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ helper.py              # Gradient aggregation & Fishr loss
â”‚   â”œâ”€â”€ model_utils.py         # CNN model architecture
â”‚   â”œâ”€â”€ creator.py             # Dataset creation and client/server setup
â”‚   â”œâ”€â”€ train_utils.py         # Training, prediction, evaluation utilities
â”‚   â”œâ”€â”€ process_data_utils.py  # Data preprocessing, splitting
â”‚   â””â”€â”€ visualization.py       # ğŸ“Š All plots for metrics & analysis
â”œâ”€â”€ data/
â”‚   â””â”€â”€ nba_iot_1000/          # N-BaIoT preprocessed CSVs per device & attack type
â”œâ”€â”€ USSFL-IDS.py               # Main training script
â””â”€â”€ README.md
```

---

## ğŸ§  Core Techniques

* **Federated Learning (FL)** across IoT devices
* **Semi-supervised Learning (SSL)** with open and private sets
* **Dirichlet distribution-based split** for simulating realistic non-IID scenarios
* **Fishr Regularization**: Aligns gradient variance to minimize distributional shift
* **Hard-label voting aggregation** from client logits

---

## ğŸ“ˆ Visualizations

| Plot Type                      | Generated By                       |
| ------------------------------ | ---------------------------------- |
| Client-Class Distribution      | `plot_class_distribution()`        |
| Accuracy, F1, Precision Curves | `plot_metrics()`                   |
| Confusion Matrix               | `plot_conf_matrix()`               |
| Comm. Overhead vs Accuracy     | `plot_comm_overhead_vs_accuracy()` |
| Î¸c Threshold Impact            | `plot_theta_accuracy()`            |
| Label Strategy Comparison      | `plot_label_strategy_comparison()` |

All graphs are generated **after the final communication round**.

---

## ğŸ›  Setup Instructions

### âœ… Prerequisites

* Python 3.8+
* PyTorch
* NumPy
* Scikit-learn
* Matplotlib

### ğŸ“¦ Install Dependencies

```bash
pip install -r requirements.txt
```

### ğŸ“ Dataset

Place preprocessed `N-BaIoT` CSVs under:

```
data/nba_iot_1000/<DeviceName>/<AttackType>_train.csv
data/nba_iot_1000/<DeviceName>/<AttackType>_test.csv
```

---

## â–¶ï¸ Running the Project

```bash
python USSFL-IDS.py
```

This will:

1. Load the dataset.
2. Create clients and server.
3. Train for configured rounds.
4. Display visual metrics.

---

## ğŸ“Š Example Output

* Final test accuracy
* F1-score and precision plots
* Confusion matrix for test predictions
* Communication overhead calculations
* Class-wise client distribution

---

## ğŸ§ª Evaluation Metrics

* **Accuracy**
* **F1-Score (Macro)**
* **Precision (Macro)**
* **Confusion Matrix**
* **Communication Cost**

---

## ğŸ“š Reference

* Zhao et al., *"Semi-supervised Federated-Learning-Based Intrusion Detection Method for Internet of Things"*, IEEE 2023
* This implementation includes original enhancements like Fishr loss and improved aggregation.

---

## âœï¸ Author

* **Your Name** â€” [LinkedIn](#) | [GitHub](#)

---

## ğŸ“Œ License

This project is for academic and research use only.

---
